BootStrap: docker
From: ubuntu:latest

%environment
    PATH=/app/uproc/scripts:/app/uproc/bin:$PATH

%runscript
    exec /app/uproc/bin/uproc-dna "$@"

%post
    apt-get update
    apt-get install -y locales git build-essential wget  zlib1g-dev # curl libcurl4-openssl-dev libssl-dev python3 python3-pip
    locale-gen en_US.UTF-8

    #
    # Put everything into $APP_DIR
    #
    export APP_DIR=/app
    mkdir -p $APP_DIR
    cd $APP_DIR
    BIN_DIR=/app/uproc/bin
    mkdir -p "$BIN_DIR"

    #
    # Mash binary
    #
    mkdir /app/src/
    cd /app/src
    wget -O uproc.tgz http://uproc.gobics.de/downloads/uproc/uproc-1.2.0.tar.gz
    tar xvf uproc.tgz
    #mkdir -p "$SRC"
    #tar -xvf uproc.tgz -C "$SRC" --strip-components=1
    #cd "$SRC"
    cd uproc-1.2.0
    ./configure --prefix /app/uproc
    make install

#    #
#    # Stampede code
#    #
#    cd $APP_DIR
#    git clone https://github.com/hurwitzlab/mash.git
#    python3 -m pip install -r /app/mash/scripts/requirements.txt
#
#    #
#    # R setup
#    #
#    gpg --keyserver keyserver.ubuntu.com --recv-key E084DAB9
#    gpg -a --export E084DAB9 | apt-key add -
#    echo "deb http://cran.rstudio.com/bin/linux/ubuntu xenial/" | \
#        tee -a /etc/apt/sources.list
#    apt-get install -y r-base r-base-dev
#
#    cat << EOF > .Rprofile
#local({
#  r = getOption("repos")
#  r["CRAN"] = "http://mirrors.nics.utk.edu/cran/"
# options(repos = r)
#})
#EOF
#
#    /usr/bin/Rscript /app/mash/scripts/install.r

    #
    # Mount points for TACC directories
    #
    mkdir /home1
    mkdir /scratch
    mkdir /work
